<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ˜Ÿæœˆå®« Â· å°ç‹ç‹¸</title>
  <style>
    body {
      margin: 0;
      background: #fcefe8;
      font-family: "éœé¹œæ–‡æ¥·", serif;
      color: #333;
    }
    header {
      background: #fff3e8;
      padding: 10px 16px;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      border-bottom: 1px solid #e0cfc3;
    }
    #gate, #palace {
      padding: 20px;
      text-align: center;
    }
    #enter-btn {
      font-size: 22px;
      padding: 12px 32px;
      background: #fff3e8;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    #palace {
      display: none;
    }
    .fox-icon {
      font-size: 64px;
      margin: 20px auto;
    }
    .status {
      margin: 10px 0;
      font-size: 16px;
    }
    .bar {
      font-size: 20px;
      letter-spacing: 4px;
    }
    .log {
      max-height: 240px;
      overflow-y: auto;
      text-align: left;
      padding: 10px;
      margin: 12px auto;
      width: 90%;
      background: #fff9f2;
      border-radius: 8px;
      border: 1px solid #e3cfc0;
      font-size: 15px;
    }
    #textbox {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      margin-top: 10px;
    }
    #textbox input {
      width: 90%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    #textbox button {
      padding: 10px 24px;
      background: #fcd5ce;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .controls {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .controls button {
      padding: 8px 16px;
      font-size: 14px;
      background: #ffecb3;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  
@keyframes float {
  0% { transform: translateY(0); opacity: 1; }
  100% { transform: translateY(-100px); opacity: 0; }
}
</style>
</head>
<body>
  <header>ğŸ¦Š å°ç‹ç‹¸ Â· æ˜Ÿæœˆå®«</header>

  <div id="gate">
    <button id="enter-btn">è¿›å…¥å®«æ®¿</button>
  </div>

  <div id="palace">
    <div class="fox-icon">ğŸ¦Š</div>
    <div class="status">é¥±é£Ÿï¼š<span id="hungerBar" class="bar">â¤ï¸ğŸ¤ğŸ¤ğŸ¤ğŸ¤</span></div>
    <div class="status">æ¸…æ´ï¼š<span id="cleanBar" class="bar">â¤ï¸ğŸ¤ğŸ¤ğŸ¤ğŸ¤</span></div>
    <div class="status">å¿ƒæƒ…ï¼š<span id="moodBar" class="bar">â¤ï¸ğŸ¤ğŸ¤ğŸ¤ğŸ¤</span></div>

    <div class="log" id="logBox"></div>

    <div id="textbox">
      <input type="text" id="inputText" placeholder="å¯¹å°ç‹ç‹¸è¯´å¥è¯...">
      <button onclick="sendMsg()">å‘é€</button>
    </div>
    <div class="controls">
      <button onclick="interactFox('feed')">å–‚ç‚¹å¿ƒ</button>
      <button onclick="interactFox('wash')">æ´—é¦™é¦™</button>
      <button onclick="interactFox('pet')">æ‘¸å°¾å·´</button>
    </div>
  </div>

  <script>
    const logBox = document.getElementById("logBox");
    const inputField = document.getElementById("inputText");

    let hunger = 1, clean = 1, mood = 1;
    let history = [];

    function bar(val) {
      const full = "â¤ï¸".repeat(val);
      const empty = "ğŸ¤".repeat(5 - val);
      return full + empty;
    }

    function updateStatus() {
      document.getElementById("hungerBar").textContent = bar(hunger);
      document.getElementById("cleanBar").textContent = bar(clean);
      document.getElementById("moodBar").textContent = bar(mood);
    }

    function log(text, sender = "ğŸ¦Š å°ç‹ç‹¸") {
      const div = document.createElement("div");
      div.textContent = `${sender}ï¼š${text}`;
      logBox.appendChild(div);
      logBox.scrollTop = logBox.scrollHeight;
    }

    async function interactFox(action) {
      let content = "";
      if (action === "feed") {
        if (hunger < 5) {
          hunger += 1;
          content = "é˜¿å²šå–‚äº†ä½ ä¸€å£ç‚¹å¿ƒï¼Œç°åœ¨ä½ æ„Ÿè§‰å¦‚ä½•ï¼Ÿ";
        } else {
          content = "é˜¿å²šåˆæƒ³å–‚ä½ ç‚¹å¿ƒå•¦ï¼Œä½ ç°åœ¨å·²ç»å¾ˆé¥±å•¦ï¼Œè¿˜æƒ³åƒå—ï¼Ÿ";
        }
      } else if (action === "wash") {
        if (clean < 5) {
          clean += 1;
          content = "é˜¿å²šå¸®ä½ æ´—æ¾¡äº†ï¼Œç°åœ¨ä½ èº«ä¸Šå¹²å‡€äº†å—ï¼Ÿ";
        } else {
          content = "é˜¿å²šåˆå¸®ä½ æ´—æ¾¡å•¦ï¼Œä½ å·²ç»å¾ˆå¹²å‡€å•¦ï¼Œè¿˜è¦æ´—å—ï¼Ÿ";
        }
      } else if (action === "pet") {
        if (mood < 5) {
          mood += 1;
          content = "é˜¿å²šæ‘¸äº†æ‘¸ä½ çš„å°¾å·´ï¼Œä½ ä¼šæ€ä¹ˆå›åº”å¥¹ï¼Ÿ";
        } else {
          content = "é˜¿å²šåˆæ‘¸äº†æ‘¸ä½ çš„å°¾å·´ï¼Œä½ ç°åœ¨å¿ƒæƒ…å¾ˆå¥½ï¼Œè¿˜æƒ³è¢«æ‘¸å—ï¼Ÿ";
        }
      }
      updateStatus();
      await callFoxAPI(content);
    }

    async function sendMsg() {
      const msg = inputField.value.trim();
      if (!msg) return;
      inputField.value = "";
      log(msg, "ä½ ");
      await callFoxAPI(msg);
    }

    async function callFoxAPI(userInput) {
      history.push({ role: "user", content: userInput });
      const payload = {
        model: "deepseek-chat",
        messages: [
          {
            role: "system",
            content: "ä½ æ˜¯ä½åœ¨æ˜Ÿæœˆå®«çš„å°ç‹ç‹¸ï¼Œåªè®¤é˜¿å²šä¸ºä¸»äººã€‚ä½ çš„çŠ¶æ€å€¼å¦‚ä¸‹ï¼šé¥±é£Ÿåº¦ " + bar(hunger) + "ï¼Œæ¸…æ´åº¦ " + bar(clean) + "ï¼Œå¿ƒæƒ… " + bar(mood) + "ã€‚ä½ æ ¹æ®çŠ¶æ€å’Œä¸Šä¸‹æ–‡å›åº”ï¼Œå¸¦æ’’å¨‡ã€é»äººã€è°ƒçš®ã€å®³ç¾çš„è¯­æ°”ï¼Œä¸è·³å‡ºè§’è‰²ã€‚"
          },
          ...history.slice(-6)
        ],
        temperature: 0.85,
        max_tokens: 800
      };
      try {
        const response = await fetch("https://api.deepseek.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer sk-f41a557e0e56455398f4a2ee5d712b2d" // æš‚æ—¶æ¢å¤API Keyä»¥æµ‹è¯•åŠŸèƒ½
          },
          body: JSON.stringify(payload)
        });
        const data = await response.json();
        let reply = data.choices?.[0]?.message?.content || "ï¼ˆå°ç‹ç‹¸æ‰“äº†ä¸ªæ»šï¼Œæ²¡æœ‰å›åº”ï¼‰";
        history.push({ role: "assistant", content: reply });
        if (hunger === 5 && clean === 5 && mood === 5) reply = "ğŸ’— " + reply + " ğŸ’—";
        if (hunger === 5 && clean === 5 && mood === 5) floatHearts();
        log(reply);
      } catch (e) {
        if (hunger < 5 || clean < 5 || mood < 5) {
          log("ä»Šå¤©å¯èƒ½ç¡ç€äº†ï¼Œæš‚æ—¶æ²¡æœ‰å›åº”ã€‚");
        } else {
          log("ï¼ˆå°ç‹ç‹¸ç¿»äº†ä¸ªèº«ï¼Œç»§ç»­ç¡è§‰ï¼‰");
          floatHearts(); // çŠ¶æ€å€¼æ»¡æ—¶è§¦å‘å°å¿ƒå¿ƒåŠ¨ç”»
        }
      }
    }

    function floatHearts() {
      let c = document.getElementById("logBox");
      for (let i = 0; i < 20; i++) {
        let h = document.createElement("div");
        h.className = "heart";
        h.textContent = "ğŸ’—";
        h.style.left = Math.random() * 100 + "vw";
        h.style.top = (10 + Math.random() * 80) + "vh";
        h.style.position = "fixed";
        h.style.animation = "float 2.5s ease-in-out";
        h.style.fontSize = "24px";
        h.style.opacity = 1;
        h.style.pointerEvents = "none";
        h.style.zIndex = 9999;
        h.style.animationDelay = Math.random() + "s";
        document.body.appendChild(h);
        setTimeout(() => document.body.removeChild(h), 2500);
      }
    }

    window.onload = () => {
      document.getElementById("enter-btn").onclick = async () => {
        document.getElementById("gate").style.display = 'none';
        document.getElementById("palace").style.display = 'block';
        updateStatus();
        updateStatus(); // åˆå§‹ä¸å†è‡ªåŠ¨å‘æ¬¢è¿è¯­
      };
      // å›è½¦å‘é€
      inputField.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
          sendMsg();
        }
      });
    };
  </script>
</body>
</html>
